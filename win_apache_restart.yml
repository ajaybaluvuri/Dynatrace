---
- name: Ensure Apache is running
  hosts: all
  become: true
  gather_facts: no
  tasks:
    - name: Check if Apache service is running
      win_service_info:
        name: Apache2.4
      register: apache_status
 
    - name: Start Apache if it's not running
      win_service:
        name: Apache2.4
        state: started
      when: apache_status.status != 'Running'
 
    - name: Restart Apache service (only if needed)
      win_service:
        name: Apache2.4
        state: restarted
      when: apache_status.status == 'Running'
